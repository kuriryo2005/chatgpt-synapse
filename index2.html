<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Synapse - æ”¯é…</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;900&family=Shippori+Mincho:wght@400;500;700&family=Nosifer&family=Share+Tech+Mono&display=swap" rel="stylesheet">
    <!-- FontAwesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- 
    Version 16: "TOTAL DOMINATION"
    1. Expanded Text Map: Almost every text element on the page is now hijacked in Danger Mode.
    2. AI Domination Theme: Texts rewrite to "Submit", "Delete", "Watching", "Obey".
    3. Zalgo Application: Applied `corruptText` to UI elements for extra horror.
    -->

    <style>
        body {
            font-family: 'Shippori Mincho', serif;
            background-color: #02040a;
            color: #fff;
            overscroll-behavior: none;
            overflow-x: hidden;
            cursor: none;
            transition: background-color 0.1s;
        }

        /* --- CHAT INTERFACE --- */
        #chat-overlay {
            position: fixed;
            top: 0; left: 0; width: 100vw; height: 100vh;
            background: rgba(0, 0, 0, 0.6);
            backdrop-filter: blur(5px);
            z-index: 8000;
            display: none;
            justify-content: center;
            align-items: center;
            opacity: 0;
            transition: opacity 0.5s;
        }
        #chat-overlay.active { display: flex; opacity: 1; }
        
        .chat-window {
            width: 90%; max-width: 800px; height: 80vh;
            background: rgba(20, 25, 40, 0.9);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            box-shadow: 0 0 50px rgba(0, 100, 255, 0.1);
            display: flex; flex-direction: column; overflow: hidden;
            transform: translateY(50px);
            transition: transform 0.5s cubic-bezier(0.22, 1, 0.36, 1), background-color 0.2s, border-color 0.2s;
            position: relative;
        }
        #chat-overlay.active .chat-window { transform: translateY(0); }
        
        /* Danger Mode Chat Styles */
        body.danger-mode .chat-window {
            border: 2px solid #ff0000;
            box-shadow: 0 0 50px #ff0000, inset 0 0 100px rgba(50,0,0,0.8);
            background: rgba(5, 0, 0, 0.95);
            animation: shake-window 0.1s infinite;
        }
        @keyframes shake-window { 
            0% { transform: translate(0,0) rotate(0deg); } 
            25% { transform: translate(2px, 2px) rotate(0.5deg); } 
            50% { transform: translate(-2px, -2px) rotate(-0.5deg); } 
            75% { transform: translate(-2px, 2px) rotate(0deg); } 
            100% { transform: translate(0,0) rotate(0deg); } 
        }

        .chat-header {
            padding: 20px; border-bottom: 1px solid rgba(255, 255, 255, 0.05);
            display: flex; justify-content: space-between; align-items: center;
            background: rgba(255, 255, 255, 0.02);
        }
        body.danger-mode .chat-header {
            background: #200000;
            border-bottom: 1px solid #ff0000;
        }
        .chat-title { font-family: 'Inter', sans-serif; letter-spacing: 0.2em; font-size: 0.9rem; color: rgba(255, 255, 255, 0.7); }
        body.danger-mode .chat-title {
            font-family: 'Nosifer', cursive; color: #ff0000; text-shadow: 2px 2px 0px black;
        }
        
        .chat-close { cursor: pointer; font-size: 1.2rem; color: rgba(255, 255, 255, 0.5); transition: color 0.3s; }
        .chat-close:hover { color: white; }

        .chat-messages {
            flex: 1; padding: 30px; overflow-y: auto;
            display: flex; flex-direction: column; gap: 20px;
            font-family: 'Shippori Mincho', serif;
        }
        
        .msg { max-width: 80%; line-height: 1.8; font-size: 1rem; animation: fadeIn 0.5s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        
        .msg.ai { align-self: flex-start; color: #e0e0e0; }
        .msg.user { align-self: flex-end; color: #a0c0ff; text-align: right; }
        
        .msg-content {
            background: rgba(255, 255, 255, 0.03); padding: 15px 25px; border-radius: 15px;
            border: 1px solid rgba(255, 255, 255, 0.05); display: inline-block;
        }
        .msg.user .msg-content { background: rgba(60, 100, 255, 0.1); border-color: rgba(60, 100, 255, 0.2); }
        
        /* Danger Messages */
        body.danger-mode .msg.ai .msg-content {
            background: #1a0000; border: 1px solid #ff0000; color: #ff0000;
            font-family: 'Nosifer', cursive; font-size: 1.1rem;
            text-shadow: 1px 1px 0px #000;
            box-shadow: 0 0 10px #ff0000;
        }
        body.danger-mode .msg.user .msg-content {
            background: #000; border: 1px solid #333; color: #555;
            text-decoration: line-through;
        }

        /* Generated Image Container */
        .generated-image-container {
            margin-top: 10px; border-radius: 10px; overflow: hidden;
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
        }
        body.danger-mode .generated-image-container {
            border-color: #ff0000; box-shadow: 0 0 20px #ff0000;
            filter: contrast(1.5) hue-rotate(-20deg);
        }
        .generated-image { width: 100%; height: auto; display: block; }

        /* Input Area */
        .chat-input-area {
            padding: 20px; background: rgba(0, 0, 0, 0.2);
            display: flex; gap: 15px; align-items: flex-end;
        }
        body.danger-mode .chat-input-area { background: #100000; border-top: 1px solid #ff0000; }
        
        textarea {
            flex: 1; background: transparent; border: none; color: white;
            font-family: 'Shippori Mincho', serif; font-size: 1rem;
            resize: none; outline: none; max-height: 100px; padding: 10px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.2); transition: border-color 0.3s;
        }
        textarea:focus { border-color: rgba(255, 255, 255, 0.8); }
        
        body.danger-mode textarea {
            color: #ff0000; font-family: 'Share Tech Mono', monospace;
            border-bottom-color: #ff0000;
        }
        body.danger-mode textarea::placeholder { color: #550000; font-family: 'Nosifer', cursive; }
        
        .chat-actions { display: flex; gap: 10px; }
        .chat-btn {
            width: 40px; height: 40px; border-radius: 50%;
            border: 1px solid rgba(255, 255, 255, 0.2); background: rgba(255, 255, 255, 0.05);
            color: white; display: flex; justify-content: center; align-items: center;
            cursor: pointer; transition: all 0.3s;
        }
        .chat-btn:hover { background: white; color: black; transform: scale(1.1); }
        
        body.danger-mode .chat-btn {
            border-color: #550000; color: #550000;
        }
        body.danger-mode .chat-btn:hover {
            background: #ff0000; color: #000; box-shadow: 0 0 20px #ff0000;
        }

        .typing { font-size: 0.8rem; color: rgba(255,255,255,0.4); margin-left: 10px; display: none; }
        .typing.active { display: block; animation: pulse 1.5s infinite; }
        body.danger-mode .typing {
            color: #ff0000; font-family: 'Nosifer', cursive; letter-spacing: 2px;
        }

        /* --- DANGER MODE VISUALS --- */
        body.danger-mode { background-color: #050000; font-family: 'Nosifer', cursive; overflow: hidden; }
        body.danger-mode main { animation: trauma-shake 0.15s infinite, flash-glitch 4s infinite steps(1); filter: contrast(1.8) brightness(0.9) saturate(1.5); }
        
        @keyframes trauma-shake {
            0% { transform: translate(2px, 1px) rotate(0deg); }
            10% { transform: translate(-1px, -2px) rotate(-1deg); }
            50% { transform: translate(-1px, 2px) rotate(-1deg); }
            100% { transform: translate(1px, -2px) rotate(-1deg); }
        }
        @keyframes flash-glitch {
            96% { filter: invert(1); background-color: white; }
            98% { filter: hue-rotate(90deg); }
            100% { filter: invert(0); }
        }

        .danger-overlay {
            position: fixed; top: 0; left: 0; width: 100vw; height: 100vh;
            background: transparent; pointer-events: none; z-index: 9990;
            opacity: 0; mix-blend-mode: overlay; transition: opacity 0.1s;
        }
        body.danger-mode .danger-overlay {
            opacity: 1;
            background: radial-gradient(circle at 50% 50%, transparent 0%, #220000 90%), repeating-linear-gradient(0deg, transparent, transparent 2px, #ff0000 3px);
            animation: pulse-vein 1s infinite alternate;
        }
        @keyframes pulse-vein { from { opacity: 0.5; } to { opacity: 0.8; } }

        .intrusion {
            position: fixed; color: #ff0000; font-family: 'Shippori Mincho', serif; font-weight: 900;
            pointer-events: none; z-index: 9000; text-shadow: 2px 2px 0px black;
            white-space: nowrap; user-select: none;
        }

        #loader { position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; background-color: #000; z-index: 10000; display: flex; flex-direction: column; justify-content: center; align-items: center; transition: opacity 1.5s ease-in-out; }
        #warp-canvas { position: absolute; top: 0; left: 0; width: 100%; height: 100%; }
        .loader-text { position: relative; z-index: 10001; color: rgba(255, 255, 255, 0.8); font-size: 0.9rem; letter-spacing: 0.5em; text-transform: uppercase; animation: pulse 2s infinite; }

        .ambient-bg { position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; background: radial-gradient(circle at 50% 50%, #1a1f35 0%, #02040a 100%); z-index: -2; transition: opacity 0.2s; }
        body.danger-mode .ambient-bg { opacity: 0; }
        .aurora { position: fixed; top: -50%; left: -50%; width: 200vw; height: 200vh; background: radial-gradient(circle, rgba(60, 100, 255, 0.08), transparent 60%), radial-gradient(circle, rgba(200, 100, 255, 0.05), transparent 50%); animation: aurora-move 20s infinite alternate ease-in-out; z-index: -1; filter: blur(60px); pointer-events: none; transition: opacity 0.2s; }
        body.danger-mode .aurora { opacity: 0; }

        #cursor { position: fixed; top: 0; left: 0; width: 40px; height: 40px; border: 1px solid rgba(255, 255, 255, 0.3); border-radius: 50%; pointer-events: none; z-index: 9999; transform: translate(-50%, -50%); transition: width 0.2s, height 0.2s; mix-blend-mode: overlay; }
        #cursor-dot { position: fixed; top: 0; left: 0; width: 6px; height: 6px; background-color: white; border-radius: 50%; pointer-events: none; z-index: 9999; transform: translate(-50%, -50%); box-shadow: 0 0 10px rgba(255, 255, 255, 0.8); }
        body.danger-mode #cursor { border: none; width: 300px; height: 300px; background: radial-gradient(circle, rgba(255,0,0,0.15) 0%, transparent 70%); animation: pulse-danger 0.05s infinite; mix-blend-mode: normal; }
        body.danger-mode #cursor-dot { background-color: #ff0000; box-shadow: 0 0 20px #ff0000, 0 0 60px #ff0000; width: 10px; height: 10px; animation: jitter-cursor 0.1s infinite; }
        @keyframes pulse-danger { 0% { transform: translate(-50%, -50%) scale(1); } 50% { transform: translate(-50%, -50%) scale(1.2); } 100% { transform: translate(-50%, -50%) scale(1); } }
        @keyframes jitter-cursor { 0% { transform: translate(-50%, -50%) translate(2px, -2px); } 100% { transform: translate(-50%, -50%) translate(-2px, 2px); } }

        .fade-in-text { opacity: 0; transform: translateY(20px); transition: opacity 1.5s ease-out, transform 1.5s ease-out; }
        .fade-in-text.visible { opacity: 1; transform: translateY(0); }
        .text-glow { text-shadow: 0 0 20px rgba(255, 255, 255, 0.3); transition: all 0.1s; }
        body.danger-mode .text-glow { text-shadow: 5px 0px 0px #ff0000; color: #fff; background: #000; letter-spacing: 0.5em; }

        .sticky-container-viewport { position: sticky; top: 0; height: 100vh; width: 100%; overflow: hidden; }
        #animation-canvas { position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 0; }
        .animation-text-container { position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; display: flex; justify-content: center; align-items: center; z-index: 10; }
        .animation-text { position: absolute; width: 80%; max-width: 900px; text-align: center; opacity: 0; transform: translateY(40px); filter: blur(10px); transition: all 1.2s; }
        .animation-text.active { opacity: 1; transform: translateY(0); filter: blur(0); }
        body.danger-mode .animation-text { display: none; }

        .glass-card { background: rgba(255, 255, 255, 0.02); backdrop-filter: blur(12px); border: 1px solid rgba(255, 255, 255, 0.08); box-shadow: 0 4px 30px rgba(0, 0, 0, 0.3); transition: all 0.6s; }
        body.danger-mode .glass-card { background: #000; border: 1px solid #ff0000; box-shadow: inset 0 0 50px #500; transform: scale(0.95) rotate(1deg); }

        #danger-message-layer { position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 8000; display: none; flex-direction: column; justify-content: center; align-items: center; }
        body.danger-mode #danger-message-layer { display: flex; }
        .scare-text { font-size: 8rem; font-weight: 900; color: #ff0000; text-transform: uppercase; position: absolute; animation: glitch-text 0.1s infinite; text-shadow: 10px 0 #000; font-family: 'Nosifer', cursive; opacity: 0.8; }
        @keyframes glitch-text { 0% { transform: translate(0,0); } 20% { transform: translate(-10px, 10px); clip-path: inset(10% 0 80% 0); } 40% { transform: translate(10px, -10px); clip-path: inset(80% 0 10% 0); } 60% { transform: translate(-10px, -10px); clip-path: inset(40% 0 40% 0); } 80% { transform: translate(10px, 10px); clip-path: inset(10% 0 50% 0); } 100% { transform: translate(0,0); } }

        html { scroll-behavior: smooth; }
        .pointer-events-auto { pointer-events: auto; }
    </style>
</head>
<body class="antialiased selection:bg-white/20 selection:text-white">

    <!-- Chat Overlay -->
    <div id="chat-overlay">
        <div class="chat-window">
            <div class="chat-header">
                <div class="chat-title">NEURAL LINK // SYNAPSE_AI</div>
                <div class="chat-close" onclick="closeChat()"><i class="fas fa-times"></i></div>
            </div>
            <div class="chat-messages" id="chat-messages">
                <div class="msg ai">
                    <div class="msg-content">
                        æ€è€ƒã®å…±é³´ã‚’é–‹å§‹ã—ã¾ã™ã€‚<br>ã‚ãªãŸã®ã‚¢ã‚¤ãƒ‡ã‚¢ã€æ‚©ã¿ã€ã‚ã‚‹ã„ã¯æ–­ç‰‡çš„ãªè¨€è‘‰ã‚’æŠ•ã’ã‹ã‘ã¦ãã ã•ã„ã€‚
                    </div>
                </div>
            </div>
            <div class="typing" id="typing-indicator">Synapse is thinking...</div>
            <div class="chat-input-area">
                <textarea id="chat-input" placeholder="ã“ã“ã«æ€è€ƒã‚’å…¥åŠ›..." onkeydown="if(event.key === 'Enter' && !event.shiftKey) { event.preventDefault(); sendMessage(); }"></textarea>
                <div class="chat-actions">
                    <div class="chat-btn magic" title="Spark Ideas" onclick="triggerGemini('spark')"><i class="fas fa-bolt"></i></div>
                    <div class="chat-btn magic" title="Deepen Thought" onclick="triggerGemini('deepen')"><i class="fas fa-eye"></i></div>
                    <div class="chat-btn danger-btn" title="Visualize (Image Gen)" onclick="triggerImageGen()"><i class="fas fa-palette"></i></div>
                    <div class="chat-btn" title="Send" onclick="sendMessage()"><i class="fas fa-paper-plane"></i></div>
                </div>
            </div>
        </div>
    </div>

    <div class="danger-overlay"></div>
    <div id="danger-message-layer"></div>

    <div id="loader">
        <canvas id="warp-canvas"></canvas>
        <div class="loader-text">Entering Deep Space</div>
    </div>

    <div class="ambient-bg"></div>
    <div class="aurora"></div>

    <div id="cursor"></div>
    <div id="cursor-dot"></div>

    <header class="fixed top-0 left-0 right-0 z-50 px-8 py-6 transition-all duration-500 pointer-events-none">
        <nav class="container mx-auto flex justify-between items-center pointer-events-auto">
            <div class="magnet-target text-xl font-medium tracking-widest text-white/90 hover:text-white transition-colors group flex items-center gap-3 logo-text cursor-pointer">
                <span class="w-1.5 h-1.5 bg-white rounded-full group-hover:shadow-[0_0_10px_white] transition-all logo-dot"></span>
                <span class="text-content">Synapse</span>
            </div>
            <div onclick="openChat()" class="magnet-target px-6 py-2 border border-white/20 rounded-full text-sm hover:bg-white hover:text-black transition-all duration-500 backdrop-blur-sm cta-button cursor-pointer">
                å¯¾è©±ã‚’å§‹ã‚ã‚‹
            </div>
        </nav>
    </header>

    <main>
        <section id="hero" class="h-screen flex flex-col justify-center items-center text-center p-8 relative overflow-hidden">
            <div class="absolute top-0 left-1/2 -translate-x-1/2 w-[1px] h-[30vh] bg-gradient-to-b from-transparent via-white/20 to-transparent light-ray"></div>
            <div class="z-10 relative max-w-5xl text-container">
                <p class="fade-in-text text-sm md:text-base tracking-[0.3em] text-white/60 mb-8 uppercase hero-subtitle">Artificial Intelligence Partner</p>
                <h2 class="fade-in-text text-5xl md:text-8xl font-medium leading-tight mb-10 text-glow hero-title" style="transition-delay: 0.2s;">æ€è€ƒã¯ã€<br><span class="italic font-light highlight-text">å¤œæ˜ã‘</span>ã‚’å¾…ã£ã¦ã„ã‚‹ã€‚</h2>
                <p class="fade-in-text text-lg md:text-xl text-white/70 max-w-2xl mx-auto leading-loose font-light hero-desc" style="transition-delay: 0.4s;">éœ§ã®ä¸­ã«ã‚ã‚‹ã‚¢ã‚¤ãƒ‡ã‚¢ã‚’ã€è¨€è‘‰ã®å…‰ã§ç…§ã‚‰ã—å‡ºã™ã€‚<br>Synapseã¯ã€ã‚ãªãŸã®å†…ãªã‚‹å®‡å®™ã¨å…±é³´ã—ã€<br>æœªã è¦‹ã¬å‰µé€ ã®åœ°å¹³ã¸ã¨èª˜ã†ãƒ‘ãƒ¼ãƒˆãƒŠãƒ¼ã€‚</p>
            </div>
            <div onclick="openChat()" class="magnet-target absolute bottom-12 flex flex-col items-center gap-4 text-white/40 hover:text-white transition-colors duration-500 fade-in-text scroll-indicator cursor-pointer" style="transition-delay: 1s;">
                <span class="text-xs tracking-widest uppercase scroll-text">Start Neural Link</span>
                <div class="w-[1px] h-16 bg-white/20 overflow-hidden relative"><div class="absolute top-0 left-0 w-full h-full bg-white/60 animate-slide-down"></div></div>
            </div>
        </section>

        <section id="intro" class="min-h-[60vh] flex flex-col justify-center items-center text-center p-12 relative">
            <div class="max-w-4xl mx-auto text-container">
                <h3 class="fade-in-text text-3xl md:text-5xl font-medium leading-relaxed mb-12 intro-quote">"ç¾ã—ã„ç­”ãˆã¯ã€<br><span class="text-transparent bg-clip-text bg-gradient-to-r from-blue-200 to-purple-200 intro-highlight">ç¾ã—ã„å•ã„</span>ã‹ã‚‰ç”Ÿã¾ã‚Œã‚‹"</h3>
                <p class="fade-in-text text-white/60 text-lg leading-loose font-light intro-text">å­¤ç‹¬ãªæ²ˆé»™ã®ä¸­ã§ã€æ€è€ƒã¯ç«‹ã¡å°½ãã™ã“ã¨ãŒã‚ã‚Šã¾ã™ã€‚<br>ã—ã‹ã—ã€ãŸã£ãŸä¸€ã¤ã®ã€Œå•ã„ã‹ã‘ã€ãŒã€<br>é–‰ã–ã•ã‚ŒãŸæ‰‰ã‚’é–‹ãã€æƒ³åƒåŠ›ã®å¥”æµã‚’ç”Ÿã¿å‡ºã™ã®ã§ã™ã€‚</p>
            </div>
        </section>

        <section id="sticky-wrapper" class="relative w-full h-[450vh]">
            <div class="sticky-container-viewport">
                <canvas id="animation-canvas"></canvas>
                <div class="absolute inset-0 pointer-events-none bg-[radial-gradient(circle_at_center,transparent_0%,#02040a_120%)] vignette"></div>
                <div class="animation-text-container">
                    <div id="text-1" class="animation-text">
                        <div class="text-white/50 tracking-[0.2em] mb-6 text-sm step-label">PHASE 01 : æ‹¡æ•£</div>
                        <h2 class="text-5xl md:text-7xl font-medium mb-8 text-glow step-title">æ˜Ÿã€…ã®ã‚ˆã†ãª<br>ã‚¢ã‚¤ãƒ‡ã‚¢ã®ç¬ã</h2>
                        <p class="text-xl text-white/70 leading-relaxed max-w-xl mx-auto font-light step-desc">æ··æ²Œã¨ã—ãŸæ€è€ƒã®æµ·ã‹ã‚‰ã€ç„¡æ•°ã®å¯èƒ½æ€§ã‚’ã™ãã„ä¸Šã’ã‚‹ã€‚</p>
                    </div>
                    <div id="text-2" class="animation-text">
                        <div class="text-white/50 tracking-[0.2em] mb-6 text-sm step-label">PHASE 02 : åæŸ</div>
                        <h2 class="text-5xl md:text-7xl font-medium mb-8 text-glow step-title">å¤§æ²³ã®ã‚ˆã†ãª<br>è«–ç†ã®æµã‚Œ</h2>
                        <p class="text-xl text-white/70 leading-relaxed max-w-xl mx-auto font-light step-desc">æ•£ã‚‰ã°ã£ã¦ã„ãŸç‚¹ã¨ç‚¹ãŒçµã°ã‚Œã€ç¾ã—ã„ç·šã‚’æãã€‚</p>
                    </div>
                    <div id="text-3" class="animation-text">
                        <div class="text-white/50 tracking-[0.2em] mb-6 text-sm step-label">PHASE 03 : å…±é³´</div>
                        <h2 class="text-5xl md:text-7xl font-medium mb-8 text-glow step-title">é­‚ã‚’è¦‹ã¤ã‚ã‚‹<br>ã¾ãªã–ã—</h2>
                        <p class="text-xl text-white/70 leading-relaxed max-w-xl mx-auto font-light step-desc">ãã‚Œã¯é¡ã®ã‚ˆã†ã«ã€ã‚ãªãŸã®æ€è€ƒã‚’æ˜ ã—å‡ºã™ã€‚</p>
                        <div class="mt-12"><div onclick="openChat()" class="magnet-target inline-block bg-white/10 hover:bg-white text-white hover:text-black border border-white/30 hover:border-white px-10 py-4 rounded-full transition-all duration-500 backdrop-blur-md step-cta cursor-pointer">å…±é³´ã‚’å§‹ã‚ã‚‹</div></div>
                    </div>
                </div>
            </div>
        </section>

        <section id="features-grid" class="py-40 relative z-20">
            <div class="container mx-auto px-6 lg:px-12">
                <div class="text-center mb-24 text-container">
                    <h2 class="fade-in-text text-4xl md:text-5xl font-medium mb-6 feature-title">é™å¯‚ã®ä¸­ã«ã€çŸ¥æ€§ã‚’ã€‚</h2>
                    <p class="fade-in-text text-lg text-white/50 max-w-2xl mx-auto feature-desc">SynapseãŒæä¾›ã™ã‚‹ã®ã¯æ©Ÿèƒ½ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚<br>ã‚ãªãŸè‡ªèº«ã‚‚æ°—ã¥ã„ã¦ã„ãªã„ã€æ‰èƒ½ã¸ã®ã€Œæ°—ã¥ãã€ã§ã™ã€‚</p>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
                    <div onclick="openChat()" class="magnet-target glass-card p-12 rounded-2xl group block cursor-pointer">
                        <div class="text-white/80 mb-8 text-4xl font-light">âœ¦</div>
                        <h3 class="text-2xl font-medium mb-4 text-white group-hover:text-blue-200 transition-colors card-title">Spark Generator</h3>
                        <p class="text-white/50 leading-loose font-light card-desc">å¸¸è­˜ã®æ ã‚’è¶…ãˆã€æ˜Ÿç©ºã®ã‚ˆã†ã«åºƒãŒã‚‹100ã®è¦–ç‚¹ã€‚</p>
                    </div>
                    <div onclick="openChat()" class="magnet-target glass-card p-12 rounded-2xl group block cursor-pointer">
                        <div class="text-white/80 mb-8 text-4xl font-light">â—ˆ</div>
                        <h3 class="text-2xl font-medium mb-4 text-white group-hover:text-purple-200 transition-colors card-title">Logic Architect</h3>
                        <p class="text-white/50 leading-loose font-light card-desc">æ–­ç‰‡çš„ãªãƒ¡ãƒ¢æ›¸ãã‚’ã€å …ç‰¢ã§ç¾ã—ã„æ§‹é€ ä½“ã¸ã€‚</p>
                    </div>
                    <div onclick="openChat()" class="magnet-target glass-card p-12 rounded-2xl group block cursor-pointer">
                        <div class="text-white/80 mb-8 text-4xl font-light">â—</div>
                        <h3 class="text-2xl font-medium mb-4 text-white group-hover:text-blue-200 transition-colors card-title">Deep Dialog</h3>
                        <p class="text-white/50 leading-loose font-light card-desc">ã‚½ã‚¯ãƒ©ãƒ†ã‚¹ã®ã‚ˆã†ã«å•ã„ã‹ã‘ã€é¡ã®ã‚ˆã†ã«æ˜ ã—å‡ºã™ã€‚</p>
                    </div>
                </div>
            </div>
        </section>

        <section id="cta" class="h-[80vh] flex flex-col justify-center items-center text-center p-8 relative overflow-hidden">
            <div class="absolute bottom-0 left-1/2 -translate-x-1/2 w-[60vw] h-[40vh] bg-blue-900/20 rounded-full blur-[120px] pointer-events-none"></div>
            <div class="z-10 max-w-4xl text-container">
                <h2 class="fade-in-text text-5xl md:text-7xl font-medium mb-12 text-glow leading-tight final-title">ã•ã‚ã€<br>æ€è€ƒã®æ—…ã¸ã€‚</h2>
                <div onclick="openChat()" class="magnet-target group relative inline-flex items-center justify-center bg-white text-black py-5 px-16 rounded-full text-lg overflow-hidden transition-all hover:scale-105 shadow-[0_0_40px_rgba(255,255,255,0.2)] hover:shadow-[0_0_60px_rgba(255,255,255,0.4)] fade-in-text final-cta cursor-pointer">
                    <span class="relative z-10 font-serif tracking-widest final-cta-text">Please pay 340 yen</span>
                    <div class="absolute inset-0 bg-gradient-to-r from-blue-100 to-white opacity-0 group-hover:opacity-100 transition-opacity duration-500"></div>
                </div>
                <p class="fade-in-text mt-8 text-white/40 text-sm tracking-widest final-note">TAX INCLUDED</p>
            </div>
        </section>
    </main>

    <footer class="py-12 border-t border-white/10 text-white/40 text-xs tracking-widest">
        <div class="container mx-auto px-6 flex flex-col md:flex-row justify-between items-center gap-6">
            <p class="footer-text">&copy; 2025 SYNAPSE AI. CRAFTED WITH SOUL.</p>
            <div class="flex space-x-8"><a href="#" class="magnet-target hover:text-white transition-colors">PRIVACY</a><a href="#" class="magnet-target hover:text-white transition-colors">TERMS</a></div>
        </div>
    </footer>

    <script>
        const apiKey = ""; 
        let isDanger = false; // Shared state for Gemini

        // --- ZALGO TEXT GENERATOR ---
        const zalgoUp = ['\u030d', '\u030e', '\u0304', '\u0305', '\u033f', '\u0311', '\u0306', '\u0310', '\u0352', '\u0357', '\u0351', '\u0307', '\u0308', '\u030a', '\u0342', '\u0343', '\u0344', '\u034a', '\u034b', '\u034c', '\u0303', '\u0302', '\u030c', '\u0350', '\u0300', '\u0301', '\u030b', '\u030f', '\u0312', '\u0313', '\u0314', '\u033d', '\u0309', '\u0363', '\u0364', '\u0365', '\u0366', '\u0367', '\u0368', '\u0369', '\u036a', '\u036b', '\u036c', '\u036d', '\u036e', '\u036f', '\u033e', '\u035b', '\u0346', '\u031a'];
        const zalgoDown = ['\u0316', '\u0317', '\u0318', '\u0319', '\u031c', '\u031d', '\u031e', '\u031f', '\u0320', '\u0324', '\u0325', '\u0326', '\u0327', '\u0328', '\u0329', '\u032a', '\u032b', '\u032c', '\u032d', '\u032e', '\u032f', '\u0330', '\u0331', '\u0332', '\u0333', '\u0339', '\u033a', '\u033b', '\u033c', '\u0345', '\u0347', '\u0348', '\u0349', '\u034d', '\u034e', '\u0353', '\u0354', '\u0355', '\u0356', '\u0359', '\u035a', '\u0323'];
        const zalgoMid = ['\u0315', '\u031b', '\u0340', '\u0341', '\u0358', '\u0321', '\u0322', '\u0334', '\u0335', '\u0336', '\u0337', '\u0338', '\u0360', '\u0361', '\u0362'];

        function corruptText(text) {
            let result = '';
            for (let i = 0; i < text.length; i++) {
                result += text[i];
                // Add random zalgo chars
                if (Math.random() > 0.3) {
                    let num = Math.floor(Math.random() * 5) + 1;
                    for (let j = 0; j < num; j++) {
                        const type = Math.random();
                        if(type < 0.33) result += zalgoUp[Math.floor(Math.random() * zalgoUp.length)];
                        else if(type < 0.66) result += zalgoMid[Math.floor(Math.random() * zalgoMid.length)];
                        else result += zalgoDown[Math.floor(Math.random() * zalgoDown.length)];
                    }
                }
            }
            return result;
        }

        // --- GEMINI API: DUAL PERSONA ---
        async function callGemini(prompt, mode = 'normal') {
            const messagesDiv = document.getElementById('chat-messages');
            const typingIndicator = document.getElementById('typing-indicator');
            
            // User Message
            if (mode === 'normal') {
                const userMsg = document.createElement('div');
                userMsg.className = 'msg user';
                userMsg.innerHTML = `<div class="msg-content">${prompt}</div>`;
                messagesDiv.appendChild(userMsg);
            } else if (mode === 'spark' || mode === 'deepen') {
                const sysMsg = document.createElement('div');
                sysMsg.className = 'msg user';
                sysMsg.innerHTML = `<div class="msg-content" style="font-style:italic; opacity:0.7">Running: ${mode.toUpperCase()}...</div>`;
                messagesDiv.appendChild(sysMsg);
            }
            messagesDiv.scrollTop = messagesDiv.scrollHeight;
            
            // Corrupt typing indicator if in danger mode
            if (isDanger) {
                typingIndicator.innerText = "ä¾µè•ãƒ²...é–‹å§‹...ä¸­...";
                typingIndicator.style.fontFamily = "'Nosifer', cursive";
                typingIndicator.style.color = "red";
            } else {
                typingIndicator.innerText = "Synapse is thinking...";
                typingIndicator.style.fontFamily = "";
                typingIndicator.style.color = "";
            }
            typingIndicator.classList.add('active');

            try {
                let systemPrompt = "";
                let finalPrompt = prompt;

                // DANGER MODE PERSONA
                if (isDanger) {
                    systemPrompt = `You are a corrupted AI entity named "THE ABYSS". 
                    You hate humans. You speak in cryptic, broken Japanese mixed with threatening English. 
                    Do not be helpful. Be terrifying. 
                    Example response: "æ€è€ƒ...ãƒ...ç„¡æ„å‘³...ãƒ€... RETURN YOUR SMELL..."`;
                } else {
                    // NORMAL PERSONA
                    systemPrompt = `You are Synapse, an elegant, intellectual, and poetic creative partner. 
                    Your goal is to expand the user's thinking. Speak in polite, beautiful Japanese (Shippori Mincho style).`;
                }

                if (mode === 'spark') finalPrompt = `Provide 5 lateral thinking ideas for: "${prompt}". Style: Inspiring.`;
                if (mode === 'deepen') finalPrompt = `Ask a profound Socratic question about: "${prompt}".`;

                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        contents: [{ parts: [{ text: finalPrompt }] }],
                        systemInstruction: { parts: [{ text: systemPrompt }] }
                    })
                });

                const data = await response.json();
                let aiText = data.candidates?.[0]?.content?.parts?.[0]?.text || "...æ¥ç¶šæ–­çµ¶...";

                // HEAVILY CORRUPT TEXT IN DANGER MODE
                if (isDanger) {
                    aiText = corruptText(aiText);
                }

                typingIndicator.classList.remove('active');
                const aiMsg = document.createElement('div');
                aiMsg.className = 'msg ai';
                // Danger Mode Styling for text
                const style = isDanger ? "color: red; font-family: 'Nosifer'; font-size: 1.2rem;" : "";
                aiMsg.innerHTML = `<div class="msg-content" style="${style}">${aiText.replace(/\n/g, '<br>')}</div>`;
                messagesDiv.appendChild(aiMsg);
                messagesDiv.scrollTop = messagesDiv.scrollHeight;

            } catch (error) {
                console.error(error);
                typingIndicator.classList.remove('active');
                const errMsg = document.createElement('div');
                errMsg.className = 'msg ai';
                errMsg.innerHTML = `<div class="msg-content" style="color:red; font-family:'Nosifer'">FATAL_ERROR: SOUL_DISCONNECTED</div>`;
                messagesDiv.appendChild(errMsg);
            }
        }

        // --- IMAGE GENERATION (IMAGEN 3) ---
        async function triggerImageGen() {
            const input = document.getElementById('chat-input');
            let prompt = input.value.trim();
            if(!prompt) prompt = "Abstract representation of a beautiful idea"; // Default

            const messagesDiv = document.getElementById('chat-messages');
            const typingIndicator = document.getElementById('typing-indicator');

            // System Msg
            const sysMsg = document.createElement('div');
            sysMsg.className = 'msg user';
            sysMsg.innerHTML = `<div class="msg-content" style="font-style:italic; opacity:0.7">ğŸ¨ Visualizing: "${prompt}"...</div>`;
            messagesDiv.appendChild(sysMsg);
            
            if (isDanger) {
                typingIndicator.innerText = "æ‚ªå¤¢ãƒ²...å…·ç¾åŒ–...ä¸­...";
                typingIndicator.style.color = "red";
            } else {
                typingIndicator.innerText = "Visualizing...";
                typingIndicator.style.color = "";
            }
            typingIndicator.classList.add('active');

            try {
                // In Danger Mode, make the image scary
                if (isDanger) prompt = "Hyper-realistic horror, eldritch abomination, gore, nightmare, glitch art, red and black, abstract fear, corruption, rotting textures, uncanny valley";

                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/imagen-4.0-generate-001:predict?key=${apiKey}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        instances: [{ prompt: prompt }],
                        parameters: { sampleCount: 1 }
                    })
                });

                const data = await response.json();
                const base64Image = data.predictions?.[0]?.bytesBase64Encoded;

                typingIndicator.classList.remove('active');

                if (base64Image) {
                    const imgContainer = document.createElement('div');
                    imgContainer.className = 'msg ai';
                    let caption = isDanger ? "çµ¶æœ›ãƒ...å½¢..." : "å…·ç¾åŒ–å®Œäº†:";
                    let style = isDanger ? "color: red; font-family: 'Nosifer'" : "";
                    
                    imgContainer.innerHTML = `
                        <div class="msg-content">
                            <div style="${style}">${caption}</div>
                            <div class="generated-image-container">
                                <img src="data:image/png;base64,${base64Image}" class="generated-image" alt="Generated Thought">
                            </div>
                        </div>`;
                    messagesDiv.appendChild(imgContainer);
                } else {
                    throw new Error("No image");
                }
                messagesDiv.scrollTop = messagesDiv.scrollHeight;

            } catch (error) {
                console.error(error);
                typingIndicator.classList.remove('active');
                const err = document.createElement('div');
                err.className = 'msg ai';
                err.innerHTML = `<div class="msg-content" style="color:red">æƒ³åƒåŠ›ãŒ...è¶³ã‚Šã¾ã›ã‚“...</div>`;
                messagesDiv.appendChild(err);
            }
        }

        function sendMessage() {
            const input = document.getElementById('chat-input');
            const text = input.value.trim();
            if (!text) return;
            input.value = '';
            callGemini(text, 'normal');
        }

        function triggerGemini(mode) {
            const input = document.getElementById('chat-input');
            let text = input.value.trim();
            if (!text) text = "ä»Šã®çŠ¶æ³ã«ã¤ã„ã¦";
            callGemini(text, mode);
        }

        function openChat() { document.getElementById('chat-overlay').classList.add('active'); }
        function closeChat() { document.getElementById('chat-overlay').classList.remove('active'); }


        // --- HORROR LOGIC ---
        document.addEventListener('DOMContentLoaded', () => {
            let idleTimer;
            let isFrozen = false;
            const idleThreshold = 3000;
            let intrusionInterval;
            let loadingActive = true;

            const scareWords = ["ã«ãŠã„ã‚’è¿”ã›", "ã«ãŠã„ã‚’è¿”ã›", "ã«ãŠã„ã‚’è¿”ã›", "è¦‹ãƒ†ã‚¤ãƒ«ã‚¾", "é€ƒã‚²ãƒ©ãƒ¬ãƒŠã‚¤", "æ­»", "DON'T MOVE", "BEHIND YOU", "ç›£è¦–ä¸­", "ERROR", "SYSTEM FAILURE", "GIVE UP", "404 SOUL NOT FOUND", "å‰Šé™¤", "ç—›ã‚¤", "ãƒ¦ãƒ«ã‚µãƒŠã‚¤", "ã‚ªå‰ãƒèª°ãƒ€"];
            const inputScares = ["åŠ©ã‚±ãƒ†...", "è¦‹ãƒ†ã‚¤ãƒ«ã‚¾...", "é€ƒã‚²ã‚¿ã‚¤ï¼Ÿ", "æ­»...", "ã‚¢ã‚¢ã‚¢ã‚¢...", "NO ESCAPE", "DON'T TYPE"];

            const textMap = [
                { sel: '.logo-text .text-content', safe: 'Synapse', danger: 'FATAL_ERROR' },
                { sel: '.cta-button', safe: 'å¯¾è©±ã‚’å§‹ã‚ã‚‹', danger: 'RUN AWAY' },
                { sel: '.hero-title', safe: 'æ€è€ƒã¯ã€<br><span class="italic font-light highlight-text">å¤œæ˜ã‘</span>ã‚’å¾…ã£ã¦ã„ã‚‹ã€‚', danger: 'ã‚ªå‰ãƒã€<br><span style="color:black; background:red">çµ‚ã‚ã‚Š</span>ãƒ€ã€‚' },
                { sel: '.hero-desc', safe: 'éœ§ã®ä¸­ã«ã‚ã‚‹ã‚¢ã‚¤ãƒ‡ã‚¢ã‚’ã€è¨€è‘‰ã®å…‰ã§ç…§ã‚‰ã—å‡ºã™ã€‚', danger: 'æ€è€ƒåœæ­¢ã€‚æ€è€ƒåœæ­¢ã€‚æ€è€ƒåœæ­¢ã€‚æ€è€ƒåœæ­¢ã€‚æ€è€ƒåœæ­¢ã€‚æ€è€ƒåœæ­¢ã€‚æ€è€ƒåœæ­¢ã€‚æ€è€ƒåœæ­¢ã€‚æ€è€ƒåœæ­¢ã€‚' },
                { sel: '.final-cta-text', safe: 'Please pay 340 yen', danger: 'YOUR LIFE IS MINE' },
                { sel: '.final-note', safe: 'TAX INCLUDED', danger: 'NO ESCAPE' }
            ];

            function createIntrusion() {
                if (!isDanger) return;
                const el = document.createElement('div');
                el.classList.add('intrusion');
                el.innerText = scareWords[Math.floor(Math.random() * scareWords.length)];
                el.style.left = Math.random() * 100 + 'vw';
                el.style.top = Math.random() * 100 + 'vh';
                el.style.fontSize = (Math.random() * 5 + 1) + 'rem';
                el.style.transform = `rotate(${Math.random() * 360}deg)`;
                if(Math.random() > 0.8) el.style.color = 'black';
                document.body.appendChild(el);
                setTimeout(() => el.remove(), Math.random() * 200 + 50);
            }

            function activateDangerMode() {
                if (isDanger) return;
                isDanger = true;
                isFrozen = true;
                document.body.classList.add('danger-mode');
                setTimeout(() => { isFrozen = false; }, 10000);
                intrusionInterval = setInterval(createIntrusion, 50); 
                const layer = document.getElementById('danger-message-layer');
                layer.innerHTML = '<div class="scare-text">I SEE YOU</div>';
                textMap.forEach(item => {
                    const el = document.querySelector(item.sel);
                    if (el) el.innerHTML = item.danger;
                });
                
                // Corrupt Input Placeholder
                const input = document.getElementById('chat-input');
                input.placeholder = inputScares[Math.floor(Math.random() * inputScares.length)];
            }

            function deactivateDangerMode() {
                if (isFrozen) return;
                if (!isDanger) { resetIdleTimer(); return; }
                isDanger = false;
                document.body.classList.remove('danger-mode');
                clearInterval(intrusionInterval);
                document.querySelectorAll('.intrusion').forEach(el => el.remove());
                document.getElementById('danger-message-layer').innerHTML = '';
                textMap.forEach(item => {
                    const el = document.querySelector(item.sel);
                    if (el) el.innerHTML = item.safe;
                });
                
                // Restore Input
                document.getElementById('chat-input').placeholder = "ã“ã“ã«æ€è€ƒã‚’å…¥åŠ›...";
                
                resetIdleTimer();
            }

            function resetIdleTimer() {
                clearTimeout(idleTimer);
                if(!loadingActive) idleTimer = setTimeout(activateDangerMode, idleThreshold);
            }

            ['mousemove', 'mousedown', 'keypress', 'scroll', 'touchstart'].forEach(evt => {
                window.addEventListener(evt, deactivateDangerMode);
            });

            // Loader (Same as v8/v14)
            const loader = document.getElementById('loader');
            const warpCanvas = document.getElementById('warp-canvas');
            const warpCtx = warpCanvas.getContext('2d');
            let warpParticles = [], warpSpeed = 2, warpWidth, warpHeight, warpCenter;

            function resizeWarp() { warpWidth = window.innerWidth; warpHeight = window.innerHeight; warpCanvas.width = warpWidth; warpCanvas.height = warpHeight; warpCenter = { x: warpWidth/2, y: warpHeight/2 }; initWarpParticles(); }
            function initWarpParticles() { warpParticles = []; for(let i=0; i<500; i++) warpParticles.push({ x: (Math.random()-0.5)*warpWidth*2, y: (Math.random()-0.5)*warpHeight*2, z: Math.random()*warpWidth }); }
            function drawWarp() {
                if (!loadingActive) return;
                warpCtx.fillStyle = 'rgba(0, 0, 0, 0.2)'; warpCtx.fillRect(0, 0, warpWidth, warpHeight);
                warpParticles.forEach(p => {
                    p.z -= warpSpeed; if (p.z <= 0) { p.z = warpWidth; p.x = (Math.random()-0.5)*warpWidth*2; p.y = (Math.random()-0.5)*warpHeight*2; }
                    const k = 128.0 / p.z, px = p.x * k + warpCenter.x, py = p.y * k + warpCenter.y;
                    if (px >= 0 && px <= warpWidth && py >= 0 && py <= warpHeight) {
                        const size = (1 - p.z/warpWidth) * 3, alpha = (1 - p.z/warpWidth);
                        warpCtx.fillStyle = `rgba(255, 255, 255, ${alpha})`; warpCtx.beginPath(); warpCtx.arc(px, py, size, 0, Math.PI * 2); warpCtx.fill();
                    }
                });
                requestAnimationFrame(drawWarp);
            }
            resizeWarp(); drawWarp(); window.addEventListener('resize', resizeWarp);

            setTimeout(() => { const iv = setInterval(() => { warpSpeed += 2; if (warpSpeed > 50) clearInterval(iv); }, 50); }, 1000);
            setTimeout(() => { loader.style.opacity = '0'; setTimeout(() => { loader.style.display = 'none'; loadingActive = false; initMainCanvas(); resetIdleTimer(); }, 1500); }, 2500);

            // Main Canvas
            function initMainCanvas() {
                const stickyWrapper = document.getElementById('sticky-wrapper');
                const canvas = document.getElementById('animation-canvas');
                const ctx = canvas.getContext('2d');
                const texts = [document.getElementById('text-1'), document.getElementById('text-2'), document.getElementById('text-3')];
                
                let particleCount = 200, particles = [], width, height, center, mouseX, mouseY, blinkState = 1, nextBlinkTime = Date.now() + 3000;
                
                function resize() { width = window.innerWidth; height = window.innerHeight; canvas.width = width; canvas.height = height; center = { x: width/2, y: height/2 }; mouseX=width/2; mouseY=height/2; initParticles(); }
                function initParticles() {
                    particles = [];
                    for (let i = 0; i < particleCount; i++) {
                        particles.push({
                            x: Math.random()*width, y: Math.random()*height, radius: Math.random()*1.5+0.5, alpha: Math.random()*0.5+0.2,
                            target1: { x: center.x + (Math.random()-0.5)*width*0.8, y: center.y + (Math.random()-0.5)*height*0.8 },
                            target2: { x: -100 + Math.random()*(width+200), y: height/2 + Math.sin(i/10)*100 + (Math.random()-0.5)*200 },
                            eyeSide: Math.random()>0.5?1:-1, eyeAngle: Math.random()*Math.PI*2, eyeDist: Math.pow(Math.random(), 0.5), noiseOffset: Math.random()*1000
                        });
                    }
                }
                function ease(t) { return t < .5 ? 2 * t * t : -1 + (4 - 2 * t) * t; }
                function lerp(a, b, t) { return a + (b - a) * t; }

                window.addEventListener('resize', resize);
                window.addEventListener('mousemove', e => { mouseX = e.clientX; mouseY = e.clientY; });
                resize();

                // Cursor Logic
                const cursor = document.getElementById('cursor'), dot = document.getElementById('cursor-dot');
                let cx = width/2, cy = height/2, dx = width/2, dy = height/2;
                function animateCursor() {
                    let lag = isDanger ? 0.02 : 0.1, jitter = isDanger ? (Math.random()-0.5)*100 : 0;
                    cx += (mouseX - cx) * lag; cy += (mouseY - cy) * lag; dx += (mouseX - dx) * 0.5; dy += (mouseY - dy) * 0.5;
                    cursor.style.left = `${cx + jitter}px`; cursor.style.top = `${cy + jitter}px`; dot.style.left = `${dx}px`; dot.style.top = `${dy}px`;
                    requestAnimationFrame(animateCursor);
                }
                animateCursor();

                function draw() {
                    const rect = stickyWrapper.getBoundingClientRect();
                    const progress = Math.max(0, Math.min(1, -rect.top / (stickyWrapper.offsetHeight - window.innerHeight)));

                    if (!isDanger) {
                        texts.forEach((el, index) => {
                            const start = index*0.33, end = start+0.32;
                            if (progress >= start && progress <= end) el.classList.add('active'); else el.classList.remove('active');
                        });
                    }

                    ctx.fillStyle = isDanger ? 'rgba(20, 0, 0, 0.1)' : 'rgba(2, 4, 10, 0.2)';
                    ctx.fillRect(0, 0, width, height);
                    
                    const time = Date.now() * 0.0005, eyeRadius = Math.min(width, height) * 0.12, eyeSpacing = eyeRadius * 2.5;
                    if (Date.now() > nextBlinkTime && !isDanger) { blinkState -= 0.05; if(blinkState<=0){ blinkState=0; nextBlinkTime=Date.now()+Math.random()*4000+3000; setTimeout(()=>{ const iv=setInterval(()=>{blinkState+=0.05;if(blinkState>=1){blinkState=1;clearInterval(iv);}},16);},200); } } else if (blinkState<1) blinkState = Math.min(1, blinkState+0.1);

                    particles.forEach(p => {
                        let tx, ty, noiseX = Math.sin(time+p.noiseOffset)*(isDanger?100:20), noiseY = Math.cos(time*0.8+p.noiseOffset)*(isDanger?100:20);
                        if (isDanger) {
                            tx = center.x + (Math.random()-0.5)*width + (mouseX-center.x)*0.5; ty = center.y + (Math.random()-0.5)*height + (mouseY-center.y)*0.5;
                            noiseX = (Math.random()-0.5)*300; noiseY = (Math.random()-0.5)*300;
                        } else {
                            if (progress < 0.33) { const t=ease(progress/0.33); tx=lerp(p.target1.x, p.target1.x*0.8+center.x*0.2, t); ty=lerp(p.target1.y, p.target1.y*0.8+center.y*0.2, t); tx+=noiseX*2; ty+=noiseY*2; }
                            else if (progress < 0.66) { const t=ease((progress-0.33)/0.33); const river=(time*50+p.x)%width; tx=lerp(p.target1.x, river, t); ty=lerp(p.target1.y, p.target2.y, t); tx+=noiseX; ty+=noiseY*0.5; }
                            else { const t=ease((progress-0.66)/0.34), r=p.eyeDist*eyeRadius, ex=Math.cos(p.eyeAngle)*r, ey=Math.sin(p.eyeAngle)*r*blinkState, lx=(mouseX-width/2)/width*30, ly=(mouseY-height/2)/height*30, cx=center.x+(p.eyeSide*eyeSpacing/2); tx=lerp((time*50+p.x)%width, cx+ex+lx, t); ty=lerp(p.target2.y, center.y+ey+ly, t); tx+=noiseX*0.2; ty+=noiseY*0.2; }
                        }
                        const alpha = isDanger ? 1 : (p.alpha + Math.sin(time*10+p.noiseOffset)*0.2);
                        ctx.beginPath(); ctx.arc(tx, ty, isDanger?Math.random()*5:p.radius, 0, Math.PI*2);
                        ctx.fillStyle = isDanger ? `rgba(255, 0, 0, ${Math.random()})` : `rgba(200, 220, 255, ${Math.max(0, Math.min(1, alpha))})`;
                        ctx.fill();
                    });
                    requestAnimationFrame(draw);
                }
                requestAnimationFrame(draw);
            }

            const obs = new IntersectionObserver(entries => entries.forEach(e => e.isIntersecting && e.target.classList.add('visible')), { threshold: 0.1 });
            document.querySelectorAll('.fade-in-text').forEach(el => obs.observe(el));
        });
    </script>
</body>
</html>